!function(n){"use strict";function i(n){return ko.isObservable(n)&&!(n.destroyAll===undefined)}function r(n,t){for(var i=0;i<n.length;++i)t(n[i])}function t(t,i){this.options=this.mergeOptions(i);this.$select=n(t);this.originalOptions=this.$select.clone()[0].options;this.query="";this.searchTimeout=null;this.options.multiple=this.$select.attr("multiple")==="multiple";this.options.onChange=n.proxy(this.options.onChange,this);this.options.onDropdownShow=n.proxy(this.options.onDropdownShow,this);this.options.onDropdownHide=n.proxy(this.options.onDropdownHide,this);this.options.onDropdownShown=n.proxy(this.options.onDropdownShown,this);this.options.onDropdownHidden=n.proxy(this.options.onDropdownHidden,this);this.buildContainer();this.buildButton();this.buildDropdown();this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();this.options.disableIfEmpty&&this.disableIfEmpty();this.$select.hide().after(this.$container)}typeof ko!="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(t,u,f){var e=f().selectedOptions,o=ko.utils.unwrapObservable(u());n(t).multiselect(o);i(e)&&(n(t).multiselect("select",ko.utils.unwrapObservable(e)),e.subscribe(function(i){var u=[],f=[];r(i,function(n){switch(n.status){case"added":u.push(n.value);break;case"deleted":f.push(n.value)}});u.length>0&&n(t).multiselect("select",u);f.length>0&&n(t).multiselect("deselect",f)},null,"arrayChange"))},update:function(t,r,u){var f=u().options,e=n(t).data("multiselect"),o=ko.utils.unwrapObservable(r());i(f)&&f.subscribe(function(){n(t).multiselect("rebuild")});e?e.updateOriginalOptions():n(t).multiselect(o)}});t.prototype={defaults:{buttonText:function(t){if(t.length===0)return this.nonSelectedText+' <b class="caret"><\/b>';if(t.length>this.numberDisplayed)return t.length+" "+this.nSelectedText+' <b class="caret"><\/b>';var i="";return t.each(function(){var t=n(this).attr("label")!==undefined?n(this).attr("label"):n(this).html();i+=t+", "}),i.substr(0,i.length-2)+' <b class="caret"><\/b>'},buttonTitle:function(t){if(t.length===0)return this.nonSelectedText;var i="";return t.each(function(){i+=n(this).text()+", "}),i.substr(0,i.length-2)},label:function(t){return n(t).attr("label")||n(t).html()},onChange:function(){},onDropdownShow:function(){},onDropdownHide:function(){},onDropdownShown:function(){},onDropdownHidden:function(){},buttonClass:"btn btn-default",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,checkboxName:!1,includeSelectAllOption:!1,includeSelectAllIfMoreThan:0,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,enableCaseInsensitiveFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected",numberDisplayed:3,disableIfEmpty:!1,templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><\/button>',ul:'<ul class="multiselect-container dropdown-menu"><\/ul>',filter:'<li class="multiselect-item filter"><div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"><\/i><\/span><input class="form-control multiselect-search" type="text"><\/div><\/li>',li:'<li><a href="javascript:void(0);"><label><\/label><\/a><\/li>',divider:'<li class="multiselect-item divider"><\/li>',liGroup:'<li class="multiselect-item group"><label class="multiselect-group"><\/label><\/li>'}},constructor:t,buildContainer:function(){this.$container=n(this.options.buttonContainer);this.$container.on("show.bs.dropdown",this.options.onDropdownShow);this.$container.on("hide.bs.dropdown",this.options.onDropdownHide);this.$container.on("shown.bs.dropdown",this.options.onDropdownShown);this.$container.on("hidden.bs.dropdown",this.options.onDropdownHidden)},buildButton:function(){this.$button=n(this.options.templates.button).addClass(this.options.buttonClass);this.$select.prop("disabled")?this.disable():this.enable();this.options.buttonWidth&&this.options.buttonWidth!=="auto"&&(this.$button.css({width:this.options.buttonWidth}),this.$container.css({width:this.options.buttonWidth}));var t=this.$select.attr("tabindex");t&&this.$button.attr("tabindex",t);this.$container.prepend(this.$button)},buildDropdown:function(){this.$ul=n(this.options.templates.ul);this.options.dropRight&&this.$ul.addClass("pull-right");this.options.maxHeight&&this.$ul.css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"});this.$container.append(this.$ul)},buildDropdownOptions:function(){this.$select.children().each(n.proxy(function(t,i){var r=n(i).prop("tagName").toLowerCase();n(i).prop("value")!==this.options.selectAllValue&&(r==="optgroup"?this.createOptgroup(i):r==="option"&&(n(i).data("role")==="divider"?this.createDivider():this.createOptionValue(i)))},this));n("li input",this.$ul).on("change",n.proxy(function(t){var i=n(t.target),u=i.prop("checked")||!1,f=i.val()===this.options.selectAllValue;this.options.selectedClass&&(u?i.parents("li").addClass(this.options.selectedClass):i.parents("li").removeClass(this.options.selectedClass));var s=i.val(),r=this.getOptionByValue(s),e=n("option",this.$select).not(r),o=n("input",this.$container).not(i);f&&(u?this.selectAll():this.deselectAll());f||(u?(r.prop("selected",!0),this.options.multiple?r.prop("selected",!0):(this.options.selectedClass&&n(o).parents("li").removeClass(this.options.selectedClass),n(o).prop("checked",!1),e.prop("selected",!1),this.$button.click()),this.options.selectedClass==="active"&&e.parents("a").css("outline","")):r.prop("selected",!1));this.$select.change();this.updateButtonText();this.updateSelectAll();this.options.onChange(r,u);if(this.options.preventInputChangeEvent)return!1},this));n("li a",this.$ul).on("touchstart click",function(t){var i,u;if(t.stopPropagation(),i=n(t.target),t.shiftKey&&(u=i.prop("checked")||!1,u)){var r=i.parents("li:last").siblings('li[class="active"]:first'),f=i.parents("li").index(),e=r.index();f>e?i.parents("li:last").prevUntil(r).each(function(){n(this).find("input:first").prop("checked",!0).trigger("change")}):i.parents("li:last").nextUntil(r).each(function(){n(this).find("input:first").prop("checked",!0).trigger("change")})}i.blur()});this.$container.off("keydown.multiselect").on("keydown.multiselect",n.proxy(function(t){var r,i,f,u;if(!n('input[type="text"]',this.$container).is(":focus"))if((t.keyCode===9||t.keyCode===27)&&this.$container.hasClass("open"))this.$button.click();else{if(r=n(this.$container).find("li:not(.divider):not(.disabled) a").filter(":visible"),!r.length)return;i=r.index(r.filter(":focus"));t.keyCode===38&&i>0?i--:t.keyCode===40&&i<r.length-1?i++:~i||(i=0);f=r.eq(i);f.focus();(t.keyCode===32||t.keyCode===13)&&(u=f.find("input"),u.prop("checked",!u.prop("checked")),u.change());t.stopPropagation();t.preventDefault()}},this))},createOptionValue:function(t){var f,r;n(t).is(":selected")&&n(t).prop("selected",!0);var o=this.options.label(t),e=n(t).val(),u=this.options.multiple?"checkbox":"radio",i=n(this.options.templates.li);n("label",i).addClass(u);this.options.checkboxName?n("label",i).append('<input type="'+u+'" name="'+this.options.checkboxName+'" />'):n("label",i).append('<input type="'+u+'" />');f=n(t).prop("selected")||!1;r=n("input",i);r.val(e);e===this.options.selectAllValue&&(i.addClass("multiselect-item multiselect-all"),r.parent().parent().addClass("multiselect-all"));n("label",i).append(" "+o);this.$ul.append(i);n(t).is(":disabled")&&r.attr("disabled","disabled").prop("disabled",!0).parents("a").attr("tabindex","-1").parents("li").addClass("disabled");r.prop("checked",f);f&&this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass)},createDivider:function(){var t=n(this.options.templates.divider);this.$ul.append(t)},createOptgroup:function(t){var r=n(t).prop("label"),i=n(this.options.templates.liGroup);n("label",i).text(r);this.$ul.append(i);n(t).is(":disabled")&&i.addClass("disabled");n("option",t).each(n.proxy(function(n,t){this.createOptionValue(t)},this))},buildSelectAll:function(){var r=this.hasSelectAll(),t,i;!r&&this.options.includeSelectAllOption&&this.options.multiple&&n("option",this.$select).length>this.options.includeSelectAllIfMoreThan&&(this.options.includeSelectAllDivider&&this.$ul.prepend(n(this.options.templates.divider)),t=n(this.options.templates.li),n("label",t).addClass("checkbox"),this.options.checkboxName?n("label",t).append('<input type="checkbox" name="'+this.options.checkboxName+'" />'):n("label",t).append('<input type="checkbox" />'),i=n("input",t),i.val(this.options.selectAllValue),t.addClass("multiselect-item multiselect-all"),i.parent().parent().addClass("multiselect-all"),n("label",t).append(" "+this.options.selectAllText),this.$ul.prepend(t),i.prop("checked",!1))},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var t=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find("option").length>=t){this.$filter=n(this.options.templates.filter);n("input",this.$filter).attr("placeholder",this.options.filterPlaceholder);this.$ul.prepend(this.$filter);this.$filter.val(this.query).on("click",function(n){n.stopPropagation()}).on("input keydown",n.proxy(function(t){clearTimeout(this.searchTimeout);this.searchTimeout=this.asyncFunction(n.proxy(function(){this.query!==t.target.value&&(this.query=t.target.value,n.each(n("li",this.$ul),n.proxy(function(t,i){var f=n("input",i).val(),e=n("label",i).text(),r="",u;this.options.filterBehavior==="text"?r=e:this.options.filterBehavior==="value"?r=f:this.options.filterBehavior==="both"&&(r=e+"\n"+f);f!==this.options.selectAllValue&&e&&(u=!1,this.options.enableCaseInsensitiveFiltering&&r.toLowerCase().indexOf(this.query.toLowerCase())>-1?u=!0:r.indexOf(this.query)>-1&&(u=!0),u?n(i).show().removeClass("filter-hidden"):n(i).hide().addClass("filter-hidden"))},this)));this.updateSelectAll()},this),300,this)},this))}}},destroy:function(){this.$container.remove();this.$select.show();this.$select.data("multiselect",null)},refresh:function(){n("option",this.$select).each(n.proxy(function(t,i){var r=n("li input",this.$ul).filter(function(){return n(this).val()===n(i).val()});n(i).is(":selected")?(r.prop("checked",!0),this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass)):(r.prop("checked",!1),this.options.selectedClass&&r.parents("li").removeClass(this.options.selectedClass));n(i).is(":disabled")?r.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):r.prop("disabled",!1).parents("li").removeClass("disabled")},this));this.updateButtonText();this.updateSelectAll()},select:function(t,i){var r;for(n.isArray(t)||(t=[t]),r=0;r<t.length;r++){var e=t[r],u=this.getOptionByValue(e),f=this.getInputByValue(e);u!==undefined&&f!==undefined&&(this.options.multiple||this.deselectAll(!1),this.options.selectedClass&&f.parents("li").addClass(this.options.selectedClass),f.prop("checked",!0),u.prop("selected",!0))}if(this.updateButtonText(),i&&t.length===1)this.options.onChange(u,!0)},clearSelection:function(){this.deselectAll(!1);this.updateButtonText();this.updateSelectAll()},deselect:function(t,i){var r;for(n.isArray(t)||(t=[t]),r=0;r<t.length;r++){var e=t[r],u=this.getOptionByValue(e),f=this.getInputByValue(e);u!==undefined&&f!==undefined&&(this.options.selectedClass&&f.parents("li").removeClass(this.options.selectedClass),f.prop("checked",!1),u.prop("selected",!1))}if(this.updateButtonText(),i&&t.length===1)this.options.onChange(u,!1)},selectAll:function(){var i=n("li input[type='checkbox']:enabled",this.$ul),t=i.filter(":visible"),u=i.length,f=t.length,r;t.prop("checked",!0);n("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").addClass(this.options.selectedClass);u===f?n("option:enabled",this.$select).prop("selected",!0):(r=t.map(function(){return n(this).val()}).get(),n("option:enabled",this.$select).filter(function(){return n.inArray(n(this).val(),r)!==-1}).prop("selected",!0))},deselectAll:function(t){var t=typeof t=="undefined"?!0:t,i,r;t?(i=n("li input[type='checkbox']:enabled",this.$ul).filter(":visible"),i.prop("checked",!1),r=i.map(function(){return n(this).val()}).get(),n("option:enabled",this.$select).filter(function(){return n.inArray(n(this).val(),r)!==-1}).prop("selected",!1),this.options.selectedClass&&n("li:not(.divider):not(.disabled)",this.$ul).filter(":visible").removeClass(this.options.selectedClass)):(n("li input[type='checkbox']:enabled",this.$ul).prop("checked",!1),n("option:enabled",this.$select).prop("selected",!1),this.options.selectedClass&&n("li:not(.divider):not(.disabled)",this.$ul).removeClass(this.options.selectedClass))},rebuild:function(){this.$ul.html("");this.options.multiple=this.$select.attr("multiple")==="multiple";this.buildSelectAll();this.buildDropdownOptions();this.buildFilter();this.updateButtonText();this.updateSelectAll();this.options.disableIfEmpty&&this.disableIfEmpty();this.options.dropRight&&this.$ul.addClass("pull-right")},dataprovider:function(t){var i="",u=0;n.each(t,function(t,f){n.isArray(f.children)?(u++,i+='<optgroup label="'+(f.title||"Group "+u)+'">',r(f.children,function(n){i+='<option value="'+n.value+'">'+(n.label||n.value)+"<\/option>"}),i+="<\/optgroup>"):i+='<option value="'+f.value+'">'+(f.label||f.value)+"<\/option>"});this.$select.html(i);this.rebuild()},enable:function(){this.$select.prop("disabled",!1);this.$button.prop("disabled",!1).removeClass("disabled")},disable:function(){this.$select.prop("disabled",!0);this.$button.prop("disabled",!0).addClass("disabled")},disableIfEmpty:function(){n("option",this.$select).length<=0?this.disable():this.enable()},setOptions:function(n){this.options=this.mergeOptions(n)},mergeOptions:function(t){return n.extend(!0,{},this.defaults,t)},hasSelectAll:function(){return n("li."+this.options.selectAllValue,this.$ul).length>0},updateSelectAll:function(){if(this.hasSelectAll()){var i=n("li:not(.multiselect-item):not(.filter-hidden) input:enabled",this.$ul),f=i.length,r=i.filter(":checked").length,t=n("li."+this.options.selectAllValue,this.$ul),u=t.find("input");r>0&&r===f?(u.prop("checked",!0),t.addClass(this.options.selectedClass)):(u.prop("checked",!1),t.removeClass(this.options.selectedClass))}},updateButtonText:function(){var t=this.getSelected();n("button.multiselect",this.$container).html(this.options.buttonText(t,this.$select));n("button.multiselect",this.$container).attr("title",this.options.buttonTitle(t,this.$select))},getSelected:function(){return n("option",this.$select).filter(":selected")},getOptionByValue:function(t){for(var r,u=n("option",this.$select),f=t.toString(),i=0;i<u.length;i=i+1)if(r=u[i],r.value===f)return n(r)},getInputByValue:function(t){for(var r,u=n("li input",this.$ul),f=t.toString(),i=0;i<u.length;i=i+1)if(r=u[i],r.value===f)return n(r)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(n,t,i){var r=Array.prototype.slice.call(arguments,3);return setTimeout(function(){n.apply(i||window,r)},t)}};n.fn.multiselect=function(i,r,u){return this.each(function(){var f=n(this).data("multiselect"),e=typeof i=="object"&&i;f||(f=new t(this,e),n(this).data("multiselect",f));typeof i=="string"&&(f[i](r,u),i==="destroy"&&n(this).data("multiselect",!1))})};n.fn.multiselect.Constructor=t;n(function(){n("select[data-role=multiselect]").multiselect()})}(window.jQuery);
//# sourceMappingURL=bootstrap-multiselect.min.js.map
